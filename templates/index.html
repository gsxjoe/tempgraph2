<!DOCTYPE html>
<html>
<head>
    <title>Pepper's Temperature Monitor</title>
    <meta http-equiv="refresh" content="5">
    <style>
        body { font-family: sans-serif; text-align: center; }
    </style>
</head>
<body>
    <h1>Raspberry Pi Temperature</h1>
    <div id="sensor_data">
        <p>Sensor 1: <span id="temp1">...</span></p>
        <p>Sensor 2: <span id="temp2">...</span></p>
    </div>
    <script>
        function fetchTemp() {
            fetch('/data')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('temp1').innerText = data.sensor1;
                    document.getElementById('temp2').innerText = data.sensor2;
                })
                .catch(error => console.error('Error fetching data:', error));
        }
        setInterval(fetchTemp, 5000);
        fetchTemp(); // Initial fetch
    </script>

    <h2>BBQ Temperature</h2>
<canvas id="tempChart" width="600" height="300"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('tempChart').getContext('2d');
    
    const data = {
        labels: [],
        datasets: [{
            label: 'Temperature (°F)',
            data: [],
            borderColor: 'rgba(255, 99, 132, 1)',
            fill: false,
            tension: 0.1
        }]
    };
    
    const config = {
        type: 'line',
        data: data,
        options: {
            scales: {
                x: {
                    type: 'time',
                    time: {
                        tooltipFormat: 'HH:mm:ss',
                        displayFormats: {
                            second: 'HH:mm:ss'
                        }
                    },
                    title: {
                        display: true,
                        text: 'Time'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'Temperature (°F)'
                    },
                    suggestedMin: 0,
                    suggestedMax: 500
                }
            }
        }
    };
    
    const tempChart = new Chart(ctx, config);
    
    const maxPoints = 100;  // Show last 30 readings
    
    async function fetchTemperature() {
        try {
            const response = await fetch('/temp');
            const json = await response.json();
            // Use timestamp and temperature
            const time = new Date(json.timestamp);
            data.labels.push(time);
            data.datasets[0].data.push(json.temperature);
            
            // Remove old data points
            if(data.labels.length > maxPoints) {
                data.labels.shift();
                data.datasets[0].data.shift();
            }
            
            tempChart.update();
        } catch (err) {
            console.error('Error fetching temperature:', err);
        }
    }
    
    // Fetch temperature every 5 seconds
    setInterval(fetchTemperature, 5000);
    // Initial fetch
    fetchTemperature();
</script>
</body>
</html>
